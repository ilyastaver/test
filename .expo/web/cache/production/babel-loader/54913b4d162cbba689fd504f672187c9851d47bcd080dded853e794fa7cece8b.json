{"ast":null,"code":"import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _objectWithoutProperties from\"@babel/runtime/helpers/objectWithoutProperties\";var _excluded=[\"children\"];import{useEffect,useState}from'react';import React,{useContext}from'react';import View from\"react-native-web/dist/exports/View\";import useStyles from\"./changeAvatar.module\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import Text from\"react-native-web/dist/exports/Text\";import PlusSvg from\"../../../assets/icons/plusSvg\";import CameraSvg from\"../../../assets/icons/cameraSvg\";import*as ImagePicker from'expo-image-picker';import ImageViewer from\"../../ImageViewer/ImageViewer\";import{ImageContext}from\"../../../context/ImageContext\";import AuthContext from\"../../../context/AuthContext\";import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ChangeAvatar(_ref){var children=_ref.children,data=_objectWithoutProperties(_ref,_excluded);var _useContext=useContext(ImageContext),updateSelectedImage=_useContext.updateSelectedImage;var styles=useStyles();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),permission=_useState2[0],setRequestPermission=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),selectedImage=_useState4[0],setSelectedImage=_useState4[1];var _useContext2=useContext(AuthContext),user=_useContext2.user,updateUser=_useContext2.updateUser;var username='admin';var password='root';useEffect(function(){_asyncToGenerator(function*(){var cameraStatus=yield ImagePicker.requestMediaLibraryPermissionsAsync();setRequestPermission(cameraStatus.status==='granted');})();});var pickImageAsync=function(){var _ref3=_asyncToGenerator(function*(){var result=yield ImagePicker.launchImageLibraryAsync({allowsEditing:true,quality:1});if(!result.canceled){uploadImage(result);}else{}});return function pickImageAsync(){return _ref3.apply(this,arguments);};}();var uploadImage=function(){var _ref4=_asyncToGenerator(function*(imageAsset){var formData=new FormData();var response=yield fetch(imageAsset.uri);var blob=yield response.blob();formData.append('file',blob,'file.jpg');var userId=user==null?void 0:user.id;var apiUrl=\"https://messengerproject-production.up.railway.app/api/users/\"+userId+\"/update/image\";try{var _response=yield axios.put(apiUrl,formData,{headers:{'Content-Type':'multipart/form-data','Authorization':\"Basic \"+btoa(username+\":\"+password)}});if(_response.status===200||_response.status===201){console.log('Image uploaded successfully');setSelectedImage(imageAsset.uri);updateSelectedImage(imageAsset.uri);}}catch(error){if(error.response&&error.response.data&&error.response.data.message){alert('Error: '+error.response.data.message);}}});return function uploadImage(_x){return _ref4.apply(this,arguments);};}();var openCamera=function(){var _ref5=_asyncToGenerator(function*(){var permissionResult=yield ImagePicker.requestCameraPermissionsAsync();if(permissionResult.granted===false){alert(\"You've refused to allow this app to access your camera!\");return;}var result=yield ImagePicker.launchCameraAsync();if(!result.canceled){setSelectedImage(result.assets[0].uri);uploadImage(result.assets[0]);}});return function openCamera(){return _ref5.apply(this,arguments);};}();return _jsx(View,{style:styles.container,children:_jsxs(View,{style:styles.round,children:[_jsxs(TouchableOpacity,{onPress:pickImageAsync,children:[!selectedImage&&_jsx(View,{style:styles.nonePhoto,children:_jsx(PlusSvg,{})}),selectedImage&&_jsx(ImageViewer,{isAvatar:true,selectedImage:selectedImage})]}),_jsx(View,{style:{position:'absolute',bottom:0,right:0},children:_jsx(TouchableOpacity,{onPress:openCamera,children:_jsx(CameraSvg,{})})})]})});}","map":{"version":3,"names":["useEffect","useState","React","useContext","View","useStyles","TouchableOpacity","Text","PlusSvg","CameraSvg","ImagePicker","ImageViewer","ImageContext","AuthContext","axios","jsx","_jsx","jsxs","_jsxs","ChangeAvatar","_ref","children","data","_objectWithoutProperties","_excluded","_useContext","updateSelectedImage","styles","_useState","_useState2","_slicedToArray","permission","setRequestPermission","_useState3","_useState4","selectedImage","setSelectedImage","_useContext2","user","updateUser","username","password","_asyncToGenerator","cameraStatus","requestMediaLibraryPermissionsAsync","status","pickImageAsync","_ref3","result","launchImageLibraryAsync","allowsEditing","quality","canceled","uploadImage","apply","arguments","_ref4","imageAsset","formData","FormData","response","fetch","uri","blob","append","userId","id","apiUrl","put","headers","btoa","console","log","error","message","alert","_x","openCamera","_ref5","permissionResult","requestCameraPermissionsAsync","granted","launchCameraAsync","assets","style","container","round","onPress","nonePhoto","isAvatar","position","bottom","right"],"sources":["C:/Users/ilias/OneDrive/Рабочий стол/messenger_project/Application/Client/components/Avatar/ChangeAvatar/changeAvatar.js"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport React, { useContext } from 'react';\r\nimport { View } from \"react-native-web\";\r\nimport useStyles from \"./changeAvatar.module\";\r\nimport { TouchableOpacity, Text } from 'react-native-web';\r\nimport PlusSvg from '../../../assets/icons/plusSvg';\r\nimport CameraSvg from '../../../assets/icons/cameraSvg';\r\nimport * as ImagePicker from 'expo-image-picker';\r\nimport ImageViewer from '../../ImageViewer/ImageViewer';\r\nimport { ImageContext } from '../../../context/ImageContext';\r\nimport AuthContext from '../../../context/AuthContext';\r\nimport axios from 'axios';\r\n\r\n\r\nexport default function ChangeAvatar({ children, ...data }) {\r\n  const { updateSelectedImage } = useContext(ImageContext);\r\n  const styles = useStyles();\r\n  const [permission, setRequestPermission] = useState(null);\r\n  const [selectedImage, setSelectedImage] = useState(null);\r\n  const { user, updateUser } = useContext(AuthContext);\r\n  const username = 'admin';\r\n  const password = 'root';\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      const cameraStatus = await ImagePicker.requestMediaLibraryPermissionsAsync();\r\n      setRequestPermission(cameraStatus.status === 'granted');\r\n    })();\r\n  });\r\n\r\n  const pickImageAsync = async () => {\r\n    let result = await ImagePicker.launchImageLibraryAsync({\r\n      allowsEditing: true,\r\n      quality: 1,\r\n    });\r\n  \r\n    if (!result.canceled) {\r\n      \r\n           // Update the selected image in the context\r\n          uploadImage(result);\r\n        \r\n      \r\n    } else {\r\n      // Keep the current image\r\n    }\r\n  };\r\n\r\n  const uploadImage = async (imageAsset) => {\r\n    const formData = new FormData();\r\n  \r\n    // Convert image URI to Blob\r\n    const response = await fetch(imageAsset.uri);\r\n    const blob = await response.blob();\r\n  \r\n    formData.append('file', blob, 'file.jpg');\r\n  \r\n    const userId = user?.id;\r\n    const apiUrl = `https://messengerproject-production.up.railway.app/api/users/${userId}/update/image`;\r\n  \r\n    try {\r\n      const response = await axios.put(apiUrl, formData, {\r\n        headers: {\r\n          'Content-Type': 'multipart/form-data',\r\n          'Authorization': `Basic ${btoa(`${username}:${password}`)}`,\r\n        },\r\n      });\r\n  \r\n      if (response.status === 200 || response.status === 201) {\r\n        console.log('Image uploaded successfully');\r\n        setSelectedImage(imageAsset.uri);\r\n        updateSelectedImage(imageAsset.uri);\r\n      } \r\n    } catch (error) {\r\n      if (error.response && error.response.data && error.response.data.message) {\r\n        alert('Error: ' + error.response.data.message);\r\n      } \r\n    }\r\n  };\r\n\r\n\r\n\r\n\r\n\r\n\r\n  const openCamera = async () => {\r\n    const permissionResult = await ImagePicker.requestCameraPermissionsAsync();\r\n\r\n    if (permissionResult.granted === false) {\r\n      alert(\"You've refused to allow this app to access your camera!\");\r\n      return;\r\n    }\r\n\r\n    const result = await ImagePicker.launchCameraAsync();\r\n\r\n    if (!result.canceled) {\r\n      setSelectedImage(result.assets[0].uri);\r\n      uploadImage(result.assets[0]);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <View style={styles.round}>\r\n        <TouchableOpacity onPress={pickImageAsync}>\r\n          {!selectedImage && <View style={styles.nonePhoto}>\r\n            <PlusSvg />\r\n          </View>}\r\n          {selectedImage && <ImageViewer isAvatar={true} selectedImage={selectedImage} />}\r\n        </TouchableOpacity>\r\n        <View style={{ position: 'absolute', bottom: 0, right: 0 }}>\r\n          <TouchableOpacity onPress={openCamera}>\r\n            <CameraSvg />\r\n          </TouchableOpacity>\r\n        </View>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}