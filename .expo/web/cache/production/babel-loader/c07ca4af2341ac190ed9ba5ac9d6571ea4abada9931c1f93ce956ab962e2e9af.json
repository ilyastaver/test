{"ast":null,"code":"import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import React,{useState,useEffect,useRef}from'react';import View from\"react-native-web/dist/exports/View\";import Text from\"react-native-web/dist/exports/Text\";import TouchableHighlight from\"react-native-web/dist/exports/TouchableHighlight\";import Modal from\"react-native-web/dist/exports/Modal\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import TextInput from\"react-native-web/dist/exports/TextInput\";import CreateSvg from\"../assets/icons/createSvg\";import useStyles from\"./styles/mainAuthScreen.module\";import{useFocusEffect}from'@react-navigation/native';import HeaderButton from\"../components/buttons/headerButton\";import MessageBody from\"../components/messageBody/messageBody\";import AuthContext from\"../context/AuthContext\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ChannelUnauthScreen(_ref){var _channelData$messages2;var navigation=_ref.navigation,route=_ref.route;var styles=useStyles();var channelId=route.params.channelId;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),shouldUseFocusEffect=_useState2[0],setShouldUseFocusEffect=_useState2[1];useEffect(function(){setShouldUseFocusEffect(false);},[channelId]);useFocusEffect(React.useCallback(function(){fetchChannelData();},[channelId]));var username='admin';var password='root';var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),channelData=_useState4[0],setChannelData=_useState4[1];var scrollViewRef=useRef(null);var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),isAtBottom=_useState6[0],setIsAtBottom=_useState6[1];useEffect(function(){var _channelData$messages;if((channelData==null?void 0:(_channelData$messages=channelData.messages)==null?void 0:_channelData$messages.length)>0&&isAtBottom){scrollViewRef.current.scrollToEnd({animated:true});}},[channelData==null?void 0:channelData.messages,isAtBottom]);var handleContentSizeChange=function handleContentSizeChange(){var isScrolledToBottom=scrollViewRef.current&&scrollViewRef.current.contentOffset&&scrollViewRef.current.contentOffset.y+scrollViewRef.current.layoutMeasurement.height>=scrollViewRef.current.contentSize.height;setIsAtBottom(isScrolledToBottom);};var fetchChannelData=function(){var _ref2=_asyncToGenerator(function*(){try{var response=yield fetch(\"https://messengerproject-production.up.railway.app/api/channels/\"+channelId,{method:'GET',headers:{'Content-Type':'application/json','Authorization':\"Basic \"+btoa(username+\":\"+password)}});if(response.ok){var _channelData=yield response.json();setChannelData(_channelData);}else{console.log('Failed to fetch channel data');}}catch(error){console.log('Error fetching channel data:',error);}});return function fetchChannelData(){return _ref2.apply(this,arguments);};}();if(!channelData){return null;}return _jsxs(View,{style:styles.containerMain,children:[_jsxs(View,{style:styles.barChanContainer,children:[_jsx(Text,{style:styles.barText,children:channelData.name}),_jsx(View,{children:_jsx(HeaderButton,{title:'Присоединиться',onPress:function onPress(){return navigation.navigate('Auth');}})})]}),_jsx(View,{style:styles.historyContainer,children:_jsx(ScrollView,{ref:scrollViewRef,onContentSizeChange:handleContentSizeChange,style:{flex:1,scrollbarWidth:0,flexDirection:'column'},children:channelData==null?void 0:(_channelData$messages2=channelData.messages)==null?void 0:_channelData$messages2.map(function(message){var _message$sender,_matchingMember$role,_message$sender2,_message$sender3;var senderId=(_message$sender=message.sender)==null?void 0:_message$sender.id;var matchingMember=channelData.members.find(function(member){return member.user.id===senderId;});var role=matchingMember==null?void 0:(_matchingMember$role=matchingMember.role)==null?void 0:_matchingMember$role.name;return _jsx(MessageBody,{data:{imageUrl:(_message$sender2=message.sender)==null?void 0:_message$sender2.image,nickname:(_message$sender3=message.sender)==null?void 0:_message$sender3.name,role:role,message:message.data,date:message.date,own:false,channel:true,unauth:true}},message.id);})})}),_jsx(View,{style:styles.bottomLeft,children:_jsx(TouchableHighlight,{onPress:function onPress(){return navigation.navigate('Auth');},children:_jsx(CreateSvg,{})})})]});}","map":{"version":3,"names":["React","useState","useEffect","useRef","View","Text","TouchableHighlight","Modal","TouchableOpacity","ScrollView","TextInput","CreateSvg","useStyles","useFocusEffect","HeaderButton","MessageBody","AuthContext","jsx","_jsx","jsxs","_jsxs","ChannelUnauthScreen","_ref","_channelData$messages2","navigation","route","styles","channelId","params","_useState","_useState2","_slicedToArray","shouldUseFocusEffect","setShouldUseFocusEffect","useCallback","fetchChannelData","username","password","_useState3","_useState4","channelData","setChannelData","scrollViewRef","_useState5","_useState6","isAtBottom","setIsAtBottom","_channelData$messages","messages","length","current","scrollToEnd","animated","handleContentSizeChange","isScrolledToBottom","contentOffset","y","layoutMeasurement","height","contentSize","_ref2","_asyncToGenerator","response","fetch","method","headers","btoa","ok","json","console","log","error","apply","arguments","style","containerMain","children","barChanContainer","barText","name","title","onPress","navigate","historyContainer","ref","onContentSizeChange","flex","scrollbarWidth","flexDirection","map","message","_message$sender","_matchingMember$role","_message$sender2","_message$sender3","senderId","sender","id","matchingMember","members","find","member","user","role","data","imageUrl","image","nickname","date","own","channel","unauth","bottomLeft"],"sources":["C:/Users/ilias/OneDrive/Рабочий стол/messenger_project/Application/Client/screens/ChannelUnauthScreen.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { View, Text, TouchableHighlight, Modal, TouchableOpacity, ScrollView, TextInput } from 'react-native-web';\r\nimport CreateSvg from '../assets/icons/createSvg';\r\nimport useStyles from './styles/mainAuthScreen.module';\r\nimport { useFocusEffect } from '@react-navigation/native';\r\nimport HeaderButton from '../components/buttons/headerButton';\r\n\r\nimport MessageBody from '../components/messageBody/messageBody';\r\nimport AuthContext from '../context/AuthContext';\r\n\r\n\r\nexport default function ChannelUnauthScreen({ navigation, route }) {\r\n    const styles = useStyles();\r\n    const { channelId } = route.params;\r\n    const [shouldUseFocusEffect, setShouldUseFocusEffect] = useState(false);\r\n    \r\n    useEffect(() => {\r\n        setShouldUseFocusEffect(false); // Reset the flag\r\n    }, [channelId]);\r\n    useFocusEffect(\r\n        React.useCallback(() => {\r\n            fetchChannelData();\r\n        }, [channelId])\r\n    );\r\n    const username = 'admin';\r\n    const password = 'root';\r\n    const [channelData, setChannelData] = useState([]);\r\n\r\n    const scrollViewRef = useRef(null);\r\n    const [isAtBottom, setIsAtBottom] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (channelData?.messages?.length > 0 && isAtBottom) {\r\n            scrollViewRef.current.scrollToEnd({ animated: true });\r\n        }\r\n    }, [channelData?.messages, isAtBottom]);\r\n\r\n    const handleContentSizeChange = () => {\r\n        const isScrolledToBottom =\r\n            scrollViewRef.current &&\r\n            scrollViewRef.current.contentOffset &&\r\n            scrollViewRef.current.contentOffset.y + scrollViewRef.current.layoutMeasurement.height >=\r\n            scrollViewRef.current.contentSize.height;\r\n\r\n        setIsAtBottom(isScrolledToBottom);\r\n    };\r\n\r\n    const fetchChannelData = async () => {\r\n        try {\r\n            const response = await fetch(`https://messengerproject-production.up.railway.app/api/channels/${channelId}`, {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Basic ${btoa(`${username}:${password}`)}`,\r\n                },\r\n            });\r\n\r\n            if (response.ok) {\r\n                const channelData = await response.json();\r\n\r\n                setChannelData(channelData);\r\n            } else {\r\n                // Handle error response\r\n                console.log('Failed to fetch channel data');\r\n            }\r\n        } catch (error) {\r\n            console.log('Error fetching channel data:', error);\r\n        }\r\n    };\r\n\r\n    if (!channelData) {\r\n        return null; // You can render a loading indicator or fallback UI here\r\n      }\r\n    return (\r\n        <View style={styles.containerMain}>\r\n            <View style={styles.barChanContainer}>\r\n                <Text style={styles.barText}>{channelData.name}</Text>\r\n                <View>\r\n                    <HeaderButton title={'Присоединиться'} onPress={() => navigation.navigate('Auth')} />\r\n                </View>\r\n            </View >\r\n            <View style={styles.historyContainer}>\r\n                <ScrollView ref={scrollViewRef} onContentSizeChange={handleContentSizeChange} style={{ flex: 1, scrollbarWidth: 0, flexDirection: 'column' }}>\r\n                {channelData?.messages?.map((message) => {\r\n                        const senderId = message.sender?.id;\r\n                        const matchingMember = channelData.members.find((member) => member.user.id === senderId);\r\n\r\n                        const role = matchingMember?.role?.name;\r\n\r\n                        return (\r\n                            <MessageBody\r\n                                key={message.id}\r\n                                data={{\r\n                                    imageUrl: message.sender?.image,\r\n                                    nickname: message.sender?.name,\r\n                                    role: role,\r\n                                    message: message.data,\r\n                                    date: message.date,\r\n                                    own: false,\r\n                                    channel: true,\r\n                                    unauth: true\r\n                                }}\r\n                              \r\n                            />\r\n                        );\r\n                    })}\r\n                </ScrollView>\r\n\r\n            </View>\r\n            <View style = {styles.bottomLeft}>\r\n             <TouchableHighlight onPress={() => navigation.navigate('Auth')}>\r\n          <CreateSvg />\r\n        </TouchableHighlight>\r\n        </View>\r\n        </View>\r\n    );\r\n}\r\n"],"mappings":"wIAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,MAAM,KAAQ,OAAO,CAAC,OAAAC,IAAA,iDAAAC,IAAA,iDAAAC,kBAAA,+DAAAC,KAAA,kDAAAC,gBAAA,6DAAAC,UAAA,uDAAAC,SAAA,+CAE3D,MAAO,CAAAC,SAAS,iCAChB,MAAO,CAAAC,SAAS,sCAChB,OAASC,cAAc,KAAQ,0BAA0B,CACzD,MAAO,CAAAC,YAAY,0CAEnB,MAAO,CAAAC,WAAW,6CAClB,MAAO,CAAAC,WAAW,8BAA+B,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAGjD,cAAe,SAAS,CAAAC,mBAAmBA,CAAAC,IAAA,CAAwB,KAAAC,sBAAA,IAArB,CAAAC,UAAU,CAAAF,IAAA,CAAVE,UAAU,CAAEC,KAAK,CAAAH,IAAA,CAALG,KAAK,CAC3D,GAAM,CAAAC,MAAM,CAAGd,SAAS,CAAC,CAAC,CAC1B,GAAQ,CAAAe,SAAS,CAAKF,KAAK,CAACG,MAAM,CAA1BD,SAAS,CACjB,IAAAE,SAAA,CAAwD5B,QAAQ,CAAC,KAAK,CAAC,CAAA6B,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAAhEG,oBAAoB,CAAAF,UAAA,IAAEG,uBAAuB,CAAAH,UAAA,IAEpD5B,SAAS,CAAC,UAAM,CACZ+B,uBAAuB,CAAC,KAAK,CAAC,CAClC,CAAC,CAAE,CAACN,SAAS,CAAC,CAAC,CACfd,cAAc,CACVb,KAAK,CAACkC,WAAW,CAAC,UAAM,CACpBC,gBAAgB,CAAC,CAAC,CACtB,CAAC,CAAE,CAACR,SAAS,CAAC,CAClB,CAAC,CACD,GAAM,CAAAS,QAAQ,CAAG,OAAO,CACxB,GAAM,CAAAC,QAAQ,CAAG,MAAM,CACvB,IAAAC,UAAA,CAAsCrC,QAAQ,CAAC,EAAE,CAAC,CAAAsC,UAAA,CAAAR,cAAA,CAAAO,UAAA,IAA3CE,WAAW,CAAAD,UAAA,IAAEE,cAAc,CAAAF,UAAA,IAElC,GAAM,CAAAG,aAAa,CAAGvC,MAAM,CAAC,IAAI,CAAC,CAClC,IAAAwC,UAAA,CAAoC1C,QAAQ,CAAC,IAAI,CAAC,CAAA2C,UAAA,CAAAb,cAAA,CAAAY,UAAA,IAA3CE,UAAU,CAAAD,UAAA,IAAEE,aAAa,CAAAF,UAAA,IAEhC1C,SAAS,CAAC,UAAM,KAAA6C,qBAAA,CACZ,GAAI,CAAAP,WAAW,eAAAO,qBAAA,CAAXP,WAAW,CAAEQ,QAAQ,eAArBD,qBAAA,CAAuBE,MAAM,EAAG,CAAC,EAAIJ,UAAU,CAAE,CACjDH,aAAa,CAACQ,OAAO,CAACC,WAAW,CAAC,CAAEC,QAAQ,CAAE,IAAK,CAAC,CAAC,CACzD,CACJ,CAAC,CAAE,CAACZ,WAAW,cAAXA,WAAW,CAAEQ,QAAQ,CAAEH,UAAU,CAAC,CAAC,CAEvC,GAAM,CAAAQ,uBAAuB,CAAG,QAA1B,CAAAA,uBAAuBA,CAAA,CAAS,CAClC,GAAM,CAAAC,kBAAkB,CACpBZ,aAAa,CAACQ,OAAO,EACrBR,aAAa,CAACQ,OAAO,CAACK,aAAa,EACnCb,aAAa,CAACQ,OAAO,CAACK,aAAa,CAACC,CAAC,CAAGd,aAAa,CAACQ,OAAO,CAACO,iBAAiB,CAACC,MAAM,EACtFhB,aAAa,CAACQ,OAAO,CAACS,WAAW,CAACD,MAAM,CAE5CZ,aAAa,CAACQ,kBAAkB,CAAC,CACrC,CAAC,CAED,GAAM,CAAAnB,gBAAgB,gBAAAyB,KAAA,CAAAC,iBAAA,CAAG,WAAY,CACjC,GAAI,CACA,GAAM,CAAAC,QAAQ,MAAS,CAAAC,KAAK,oEAAoEpC,SAAS,CAAI,CACzGqC,MAAM,CAAE,KAAK,CACbC,OAAO,CAAE,CACL,cAAc,CAAE,kBAAkB,CAClC,eAAe,UAAWC,IAAI,CAAI9B,QAAQ,KAAIC,QAAU,CAC5D,CACJ,CAAC,CAAC,CAEF,GAAIyB,QAAQ,CAACK,EAAE,CAAE,CACb,GAAM,CAAA3B,YAAW,MAAS,CAAAsB,QAAQ,CAACM,IAAI,CAAC,CAAC,CAEzC3B,cAAc,CAACD,YAAW,CAAC,CAC/B,CAAC,IAAM,CAEH6B,OAAO,CAACC,GAAG,CAAC,8BAA8B,CAAC,CAC/C,CACJ,CAAE,MAAOC,KAAK,CAAE,CACZF,OAAO,CAACC,GAAG,CAAC,8BAA8B,CAAEC,KAAK,CAAC,CACtD,CACJ,CAAC,iBArBK,CAAApC,gBAAgBA,CAAA,SAAAyB,KAAA,CAAAY,KAAA,MAAAC,SAAA,OAqBrB,CAED,GAAI,CAACjC,WAAW,CAAE,CACd,MAAO,KAAI,CACb,CACF,MACI,CAAApB,KAAA,CAAChB,IAAI,EAACsE,KAAK,CAAEhD,MAAM,CAACiD,aAAc,CAAAC,QAAA,EAC9BxD,KAAA,CAAChB,IAAI,EAACsE,KAAK,CAAEhD,MAAM,CAACmD,gBAAiB,CAAAD,QAAA,EACjC1D,IAAA,CAACb,IAAI,EAACqE,KAAK,CAAEhD,MAAM,CAACoD,OAAQ,CAAAF,QAAA,CAAEpC,WAAW,CAACuC,IAAI,CAAO,CAAC,CACtD7D,IAAA,CAACd,IAAI,EAAAwE,QAAA,CACD1D,IAAA,CAACJ,YAAY,EAACkE,KAAK,CAAE,gBAAiB,CAACC,OAAO,CAAE,SAAAA,QAAA,QAAM,CAAAzD,UAAU,CAAC0D,QAAQ,CAAC,MAAM,CAAC,EAAC,CAAE,CAAC,CACnF,CAAC,EACJ,CAAC,CACRhE,IAAA,CAACd,IAAI,EAACsE,KAAK,CAAEhD,MAAM,CAACyD,gBAAiB,CAAAP,QAAA,CACjC1D,IAAA,CAACT,UAAU,EAAC2E,GAAG,CAAE1C,aAAc,CAAC2C,mBAAmB,CAAEhC,uBAAwB,CAACqB,KAAK,CAAE,CAAEY,IAAI,CAAE,CAAC,CAAEC,cAAc,CAAE,CAAC,CAAEC,aAAa,CAAE,QAAS,CAAE,CAAAZ,QAAA,CAC5IpC,WAAW,eAAAjB,sBAAA,CAAXiB,WAAW,CAAEQ,QAAQ,eAArBzB,sBAAA,CAAuBkE,GAAG,CAAC,SAACC,OAAO,CAAK,KAAAC,eAAA,CAAAC,oBAAA,CAAAC,gBAAA,CAAAC,gBAAA,CACjC,GAAM,CAAAC,QAAQ,EAAAJ,eAAA,CAAGD,OAAO,CAACM,MAAM,eAAdL,eAAA,CAAgBM,EAAE,CACnC,GAAM,CAAAC,cAAc,CAAG1D,WAAW,CAAC2D,OAAO,CAACC,IAAI,CAAC,SAACC,MAAM,QAAK,CAAAA,MAAM,CAACC,IAAI,CAACL,EAAE,GAAKF,QAAQ,GAAC,CAExF,GAAM,CAAAQ,IAAI,CAAGL,cAAc,eAAAN,oBAAA,CAAdM,cAAc,CAAEK,IAAI,eAApBX,oBAAA,CAAsBb,IAAI,CAEvC,MACI,CAAA7D,IAAA,CAACH,WAAW,EAERyF,IAAI,CAAE,CACFC,QAAQ,EAAAZ,gBAAA,CAAEH,OAAO,CAACM,MAAM,eAAdH,gBAAA,CAAgBa,KAAK,CAC/BC,QAAQ,EAAAb,gBAAA,CAAEJ,OAAO,CAACM,MAAM,eAAdF,gBAAA,CAAgBf,IAAI,CAC9BwB,IAAI,CAAEA,IAAI,CACVb,OAAO,CAAEA,OAAO,CAACc,IAAI,CACrBI,IAAI,CAAElB,OAAO,CAACkB,IAAI,CAClBC,GAAG,CAAE,KAAK,CACVC,OAAO,CAAE,IAAI,CACbC,MAAM,CAAE,IACZ,CAAE,EAVGrB,OAAO,CAACO,EAYhB,CAAC,CAEV,CAAC,CAAC,CACM,CAAC,CAEX,CAAC,CACP/E,IAAA,CAACd,IAAI,EAACsE,KAAK,CAAIhD,MAAM,CAACsF,UAAW,CAAApC,QAAA,CAChC1D,IAAA,CAACZ,kBAAkB,EAAC2E,OAAO,CAAE,SAAAA,QAAA,QAAM,CAAAzD,UAAU,CAAC0D,QAAQ,CAAC,MAAM,CAAC,EAAC,CAAAN,QAAA,CAClE1D,IAAA,CAACP,SAAS,GAAE,CAAC,CACK,CAAC,CACf,CAAC,EACD,CAAC,CAEf"},"metadata":{},"sourceType":"module","externalDependencies":[]}