{"ast":null,"code":"import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import React,{createContext,useEffect,useState,useContext}from'react';import AsyncStorage from'@react-native-async-storage/async-storage';import{ImageContext}from\"./ImageContext\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthContext=createContext();export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoggedIn=_useState2[0],setIsLoggedIn=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useContext=useContext(ImageContext),updateSelectedImage=_useContext.updateSelectedImage;useEffect(function(){checkLoginStatus();},[]);var checkLoginStatus=function(){var _ref2=_asyncToGenerator(function*(){try{var isLoggedInValue=yield AsyncStorage.getItem('isLoggedIn');var userData=yield AsyncStorage.getItem('user');if(isLoggedInValue==='true'&&userData){setIsLoggedIn(true);setUser(JSON.parse(userData));}}catch(error){console.error('Error during checkLoginStatus:',error);}});return function checkLoginStatus(){return _ref2.apply(this,arguments);};}();var login=function(){var _ref3=_asyncToGenerator(function*(userData){setIsLoggedIn(true);setUser(userData);try{yield AsyncStorage.clear();yield AsyncStorage.setItem('isLoggedIn','true');yield AsyncStorage.setItem('user',JSON.stringify(userData));}catch(error){console.error('Error during login:',error);}});return function login(_x){return _ref3.apply(this,arguments);};}();var logout=function(){var _ref4=_asyncToGenerator(function*(){setIsLoggedIn(false);setUser(null);updateSelectedImage(null);try{yield AsyncStorage.removeItem('isLoggedIn');yield AsyncStorage.removeItem('user');navigation.navigate(\"Auth\");}catch(error){console.error('Error during logout:',error);}});return function logout(){return _ref4.apply(this,arguments);};}();var updateUser=function updateUser(updatedUser){setUser(updatedUser);};var authContextValue={isLoggedIn:isLoggedIn,user:user,login:login,logout:logout,updateUser:updateUser};return _jsx(AuthContext.Provider,{value:authContextValue,children:children});};export default AuthContext;","map":{"version":3,"names":["React","createContext","useEffect","useState","useContext","AsyncStorage","ImageContext","jsx","_jsx","AuthContext","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","isLoggedIn","setIsLoggedIn","_useState3","_useState4","user","setUser","_useContext","updateSelectedImage","checkLoginStatus","_ref2","_asyncToGenerator","isLoggedInValue","getItem","userData","JSON","parse","error","console","apply","arguments","login","_ref3","clear","setItem","stringify","_x","logout","_ref4","removeItem","navigation","navigate","updateUser","updatedUser","authContextValue","Provider","value"],"sources":["C:/Users/ilias/OneDrive/Рабочий стол/messenger_project/Application/Client/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useEffect, useState, useContext } from 'react';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport { ImageContext } from './ImageContext';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\r\n  const [user, setUser] = useState(null);\r\n  const { updateSelectedImage } = useContext(ImageContext);\r\n\r\n  useEffect(() => {\r\n    checkLoginStatus();\r\n  }, []);\r\n\r\n  const checkLoginStatus = async () => {\r\n    try {\r\n      const isLoggedInValue = await AsyncStorage.getItem('isLoggedIn');\r\n      const userData = await AsyncStorage.getItem('user');\r\n      if (isLoggedInValue === 'true' && userData) {\r\n        setIsLoggedIn(true);\r\n        setUser(JSON.parse(userData));\r\n      }\r\n    } catch (error) {\r\n      console.error('Error during checkLoginStatus:', error);\r\n    }\r\n  };\r\n\r\n  const login = async (userData) => {\r\n    setIsLoggedIn(true);\r\n    setUser(userData);\r\n    try {\r\n      await AsyncStorage.clear(); // Clear existing data before setting new data\r\n      await AsyncStorage.setItem('isLoggedIn', 'true');\r\n      await AsyncStorage.setItem('user', JSON.stringify(userData));\r\n    } catch (error) {\r\n      console.error('Error during login:', error);\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    setIsLoggedIn(false);\r\n    setUser(null);\r\n    updateSelectedImage(null); // Clear the selected image\r\n    try {\r\n      await AsyncStorage.removeItem('isLoggedIn');\r\n      await AsyncStorage.removeItem('user');\r\n      navigation.navigate(\"Auth\"); // Assuming you have a navigation object available\r\n    } catch (error) {\r\n      console.error('Error during logout:', error);\r\n    }\r\n  };\r\n\r\n  const updateUser = (updatedUser) => {\r\n    setUser(updatedUser);\r\n  };\r\n\r\n  const authContextValue = {\r\n    isLoggedIn,\r\n    user,\r\n    login,\r\n    logout,\r\n    updateUser\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={authContextValue}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport default AuthContext;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}