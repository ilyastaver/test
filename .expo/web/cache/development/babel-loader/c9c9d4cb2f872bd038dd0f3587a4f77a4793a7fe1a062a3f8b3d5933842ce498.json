{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"children\"];\nimport { useEffect, useState } from 'react';\nimport React, { useContext } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport useStyles from \"./changeAvatar.module\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport PlusSvg from \"../../../assets/icons/plusSvg\";\nimport CameraSvg from \"../../../assets/icons/cameraSvg\";\nimport * as ImagePicker from 'expo-image-picker';\nimport ImageViewer from \"../../ImageViewer/ImageViewer\";\nimport { ImageContext } from \"../../../context/ImageContext\";\nimport AuthContext from \"../../../context/AuthContext\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function ChangeAvatar(_ref) {\n  var children = _ref.children,\n    data = _objectWithoutProperties(_ref, _excluded);\n  var _useContext = useContext(ImageContext),\n    updateSelectedImage = _useContext.updateSelectedImage;\n  var styles = useStyles();\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    permission = _useState2[0],\n    setRequestPermission = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    selectedImage = _useState4[0],\n    setSelectedImage = _useState4[1];\n  var _useContext2 = useContext(AuthContext),\n    user = _useContext2.user,\n    updateUser = _useContext2.updateUser;\n  var username = 'admin';\n  var password = 'root';\n  useEffect(function () {\n    _asyncToGenerator(function* () {\n      var cameraStatus = yield ImagePicker.requestMediaLibraryPermissionsAsync();\n      setRequestPermission(cameraStatus.status === 'granted');\n    })();\n  });\n  var pickImageAsync = function () {\n    var _ref3 = _asyncToGenerator(function* () {\n      var result = yield ImagePicker.launchImageLibraryAsync({\n        allowsEditing: true,\n        quality: 1,\n        mediaTypes: ImagePicker.MediaTypeOptions.Images,\n        allowsMultipleSelection: false\n      });\n      if (!result.cancelled) {\n        var userId = user == null ? void 0 : user.id;\n        try {\n          var formData = new FormData();\n          formData.append('image', {\n            uri: result.uri,\n            type: 'image/jpeg',\n            name: 'avatar.jpg'\n          });\n          var response = yield fetch(\"http://localhost:8080/api/users/\" + userId + \"/update/image\", {\n            method: 'PUT',\n            headers: {\n              'Content-Type': 'multipart/form-data',\n              'Authorization': \"Basic \" + btoa(username + \":\" + password)\n            },\n            body: formData\n          });\n          if (response.ok) {\n            console.log('Image updated successfully');\n            updateSelectedImage(result.uri);\n          } else {\n            console.error('Failed to update image');\n          }\n        } catch (error) {\n          console.error('Error updating image:', error);\n        }\n      } else {}\n    });\n    return function pickImageAsync() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var openCamera = function () {\n    var _ref4 = _asyncToGenerator(function* () {\n      var permissionResult = yield ImagePicker.requestCameraPermissionsAsync();\n      if (permissionResult.granted === false) {\n        alert(\"You've refused to allow this app to access your camera!\");\n        return;\n      }\n      var result = yield ImagePicker.launchCameraAsync();\n      if (!result.cancelled) {\n        setSelectedImage(result.assets[0].uri);\n      }\n    });\n    return function openCamera() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  return _jsx(View, {\n    style: styles.container,\n    children: _jsxs(View, {\n      style: styles.round,\n      children: [_jsxs(TouchableOpacity, {\n        onPress: pickImageAsync,\n        children: [!selectedImage && _jsx(View, {\n          style: styles.nonePhoto,\n          children: _jsx(PlusSvg, {})\n        }), selectedImage && _jsx(ImageViewer, {\n          isAvatar: true,\n          selectedImage: selectedImage\n        })]\n      }), _jsx(View, {\n        style: {\n          position: 'absolute',\n          bottom: 0,\n          right: 0\n        },\n        children: _jsx(TouchableOpacity, {\n          onPress: openCamera,\n          children: _jsx(CameraSvg, {})\n        })\n      })]\n    })\n  });\n}","map":{"version":3,"names":["useEffect","useState","React","useContext","View","useStyles","TouchableOpacity","Text","PlusSvg","CameraSvg","ImagePicker","ImageViewer","ImageContext","AuthContext","jsx","_jsx","jsxs","_jsxs","ChangeAvatar","_ref","children","data","_objectWithoutProperties","_excluded","_useContext","updateSelectedImage","styles","_useState","_useState2","_slicedToArray","permission","setRequestPermission","_useState3","_useState4","selectedImage","setSelectedImage","_useContext2","user","updateUser","username","password","_asyncToGenerator","cameraStatus","requestMediaLibraryPermissionsAsync","status","pickImageAsync","_ref3","result","launchImageLibraryAsync","allowsEditing","quality","mediaTypes","MediaTypeOptions","Images","allowsMultipleSelection","cancelled","userId","id","formData","FormData","append","uri","type","name","response","fetch","method","headers","btoa","body","ok","console","log","error","apply","arguments","openCamera","_ref4","permissionResult","requestCameraPermissionsAsync","granted","alert","launchCameraAsync","assets","style","container","round","onPress","nonePhoto","isAvatar","position","bottom","right"],"sources":["C:/Users/ilias/OneDrive/Рабочий стол/messenger_project/Application/Client/components/Avatar/ChangeAvatar/changeAvatar.js"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport React, { useContext } from 'react';\r\nimport { View } from \"react-native-web\";\r\nimport useStyles from \"./changeAvatar.module\";\r\nimport { TouchableOpacity, Text } from 'react-native-web';\r\nimport PlusSvg from '../../../assets/icons/plusSvg';\r\nimport CameraSvg from '../../../assets/icons/cameraSvg';\r\nimport * as ImagePicker from 'expo-image-picker';\r\nimport ImageViewer from '../../ImageViewer/ImageViewer';\r\nimport { ImageContext } from '../../../context/ImageContext';\r\nimport AuthContext from '../../../context/AuthContext';\r\n\r\n\r\nexport default function ChangeAvatar({ children, ...data }) {\r\n  const { updateSelectedImage } = useContext(ImageContext);\r\n  const styles = useStyles();\r\n  const [permission, setRequestPermission] = useState(null);\r\n  const [selectedImage, setSelectedImage] = useState(null);\r\n  const { user, updateUser } = useContext(AuthContext);\r\n  const username = 'admin';\r\n  const password = 'root';\r\n  useEffect(() => {\r\n    (async () => {\r\n      const cameraStatus = await ImagePicker.requestMediaLibraryPermissionsAsync();\r\n      setRequestPermission(cameraStatus.status === 'granted');\r\n    })();\r\n  });\r\n\r\n  const pickImageAsync = async () => {\r\n    let result = await ImagePicker.launchImageLibraryAsync({\r\n      allowsEditing: true,\r\n      quality: 1,\r\n      mediaTypes: ImagePicker.MediaTypeOptions.Images, // Only allow image files\r\n      allowsMultipleSelection: false, // Disable multiple selection\r\n    });\r\n\r\n    if (!result.cancelled) {\r\n      // Assuming you have the user's ID available\r\n      const userId = user?.id;\r\n\r\n      try {\r\n        const formData = new FormData();\r\n        formData.append('image', {\r\n          uri: result.uri,\r\n          type: 'image/jpeg', // Adjust the file type based on your requirements\r\n          name: 'avatar.jpg', // Set a desired file name\r\n        });\r\n\r\n        const response = await fetch(`http://localhost:8080/api/users/${userId}/update/image`, {\r\n          method: 'PUT',\r\n          headers: {\r\n            'Content-Type': 'multipart/form-data',\r\n            'Authorization': `Basic ${btoa(`${username}:${password}`)}`,\r\n          },\r\n          body: formData,\r\n        });\r\n\r\n        if (response.ok) {\r\n          console.log('Image updated successfully');\r\n          // Update the selected image in the context\r\n          updateSelectedImage(result.uri);\r\n        } else {\r\n          console.error('Failed to update image');\r\n        }\r\n      } catch (error) {\r\n        console.error('Error updating image:', error);\r\n      }\r\n    } else {\r\n      //оставить текущую\r\n    }\r\n  };\r\n\r\n  const openCamera = async () => {\r\n    const permissionResult = await ImagePicker.requestCameraPermissionsAsync();\r\n\r\n    if (permissionResult.granted === false) {\r\n      alert(\"You've refused to allow this app to access your camera!\");\r\n      return;\r\n    }\r\n\r\n    const result = await ImagePicker.launchCameraAsync();\r\n\r\n    if (!result.cancelled) {\r\n      setSelectedImage(result.assets[0].uri);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <View style={styles.round}>\r\n        <TouchableOpacity onPress={pickImageAsync}>\r\n          {!selectedImage && <View style={styles.nonePhoto}>\r\n            <PlusSvg />\r\n          </View>}\r\n          {selectedImage && <ImageViewer isAvatar={true} selectedImage={selectedImage} />}\r\n        </TouchableOpacity>\r\n        <View style={{ position: 'absolute', bottom: 0, right: 0 }}>\r\n          <TouchableOpacity onPress={openCamera}>\r\n            <CameraSvg />\r\n          </TouchableOpacity>\r\n        </View>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}